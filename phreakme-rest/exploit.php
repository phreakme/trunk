<h1>Exploit</h1>
<?php
$callerid = shell_exec("curl http://localhost/service/setup/globalcid");
$globalcid = $callerid;
$targets = shell_exec("curl http://localhost/service/setup/targets");
$targetArr = json_decode($targets);
?>
<script>
function sleep(milliseconds) {
  var start = new Date().getTime();
  for (var i = 0; i < 1e7; i++) {
    if ((new Date().getTime() - start) > milliseconds){
      break;
    }
  }
}

// set caller id
        function targetDial(target) {
               if (window.confirm("Are You Sure?")) {
        	dial(target);
	}
	}

	function dial(target) {
		post =  "/service/exploit/" + target + "/" + $("#cid" + target).val();
		$.get(post, function(data) {$(".result").html(data); });
	}
	function dialAll() {
		all = JSON.parse('<?=$targets;?>');
		delay = $("#delay").val() * 1000;
//		alert(all + " " + delay);
	if (window.confirm("Are You Sure?")) {
		
	 	for (i = 0; i < all.length; i++) {
			dialNum = all[i];
			if ($("#allCheck").is(":checked") && i != 0) {
				sleep(delay);
			}
			dial(dialNum);
		}	
	
	}

	}

</script>

<h3>Single Target</h3>

<?php
foreach ($targetArr As $row) {
echo  $row . ' <input type="text" id="cid'.$row.'" value="'.$callerid.'"/> <button type="button" onclick="targetDial('.$row.')" id="targetDial" value="'.$row.'">Dial</button><br/>'."\n";
}
?>

<h3>All Targets</h3>

<p>All Targets get dialed with the caller ID defined above. If you didn't not change it, it is the globalcid: "<?=$globalcid;?>"<br/> 
<input type="checkbox" id="allCheck">Time Between Targets <input type="text" value="30" name="delay" id="delay" size="3"> secs 
<button onclick="javascript:dialAll()">Dial All</button>
<div id="allConsole">
</div>
